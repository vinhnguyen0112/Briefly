const { v4: uuidv4 } = require("uuid");
const dbHelper = require("../helpers/dbHelper");

const submitFeedback = async (req, res, next) => {
  try {
    const { stars, comment } = req.body;
    // Validate stars
    if (!stars || typeof stars !== "number" || stars < 1 || stars > 5) {
      return res.status(400).json({ error: "Invalid stars" });
    }
    const id = uuidv4();
    const created_at = new Date();
    // message_id, user_id, anon_session_id để null
    await dbHelper.executeQuery(
      `INSERT INTO feedbacks (id, message_id, user_id, anon_session_id, stars, comment, created_at)
       VALUES (?, NULL, NULL, NULL, ?, ?, ?)`,
      [id, stars, comment || null, created_at]
    );
    res.json({ success: true, id });
  } catch (err) {
    next(err);
  }
};

module.exports = { submitFeedback };

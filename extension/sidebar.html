<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Briefly</title>
    <link rel="stylesheet" href="styles/sidebar.css" />
    <link rel="stylesheet" href="styles/config.css" />
    <link rel="stylesheet" href="styles/content-viewer.css" />
  </head>
  <body>
    <div class="sidebar">
      <div id="sidebar-resize-handle" class="resize-handle"></div>
      <div class="sidebar-header">
        <h2 id="cocbot-title" class="cocbot-title" data-i18n="title">
          Briefly
        </h2>
        <div class="sidebar-actions">
          <button
            id="view-content-button"
            class="icon-button"
            data-i18n-title="viewPageContent"
            title="View Page Content"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
          </button>
          <button
            id="notes-button"
            class="icon-button"
            data-i18n-title="notes"
            title="Notes"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"
              ></path>
              <path
                d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"
              ></path>
            </svg>
          </button>
          <button
            id="config-button"
            class="icon-button"
            data-i18n-title="configure"
            title="Configure"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="4" y1="21" x2="4" y2="14"></line>
              <line x1="4" y1="10" x2="4" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="12"></line>
              <line x1="12" y1="8" x2="12" y2="3"></line>
              <line x1="20" y1="21" x2="20" y2="16"></line>
              <line x1="20" y1="12" x2="20" y2="3"></line>
              <line x1="1" y1="14" x2="7" y2="14"></line>
              <line x1="9" y1="8" x2="15" y2="8"></line>
              <line x1="17" y1="16" x2="23" y2="16"></line>
            </svg>
          </button>
          <button
            id="settings-button"
            class="icon-button"
            data-i18n-title="settings"
            title="Settings"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="3"></circle>
              <path
                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"
              ></path>
            </svg>
          </button>
          <button id="account-button" class="icon-button" title="Account">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              fill="currentColor"
              viewBox="0 0 24 24"
            >
              <title>account-circle-outline</title>
              <path
                d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M7.07,18.28C7.5,17.38 10.12,16.5 12,16.5C13.88,16.5 16.5,17.38 16.93,18.28C15.57,19.36 13.86,20 12,20C10.14,20 8.43,19.36 7.07,18.28M18.36,16.83C16.93,15.09 13.46,14.5 12,14.5C10.54,14.5 7.07,15.09 5.64,16.83C4.62,15.5 4,13.82 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,13.82 19.38,15.5 18.36,16.83M12,6C10.06,6 8.5,7.56 8.5,9.5C8.5,11.44 10.06,13 12,13C13.94,13 15.5,11.44 15.5,9.5C15.5,7.56 13.94,6 12,6M12,11A1.5,1.5 0 0,1 10.5,9.5A1.5,1.5 0 0,1 12,8A1.5,1.5 0 0,1 13.5,9.5A1.5,1.5 0 0,1 12,11Z"
              />
            </svg>
          </button>
          <button
            id="close-sidebar"
            class="icon-button"
            data-i18n-title="close"
            title="Close"
          >
            ×
          </button>
        </div>
      </div>

      <div class="sidebar-content-wrapper">
        <!-- Language toggle -->
        <div class="language-toggle-section">
          <div class="language-toggle-container">
            <span class="toggle-label" id="en-label">EN</span>
            <label class="switch">
              <input type="checkbox" id="language-toggle" />
              <span class="slider round"></span>
            </label>
            <span class="toggle-label" id="vi-label">VI</span>
          </div>
        </div>

        <!-- Welcome screen (shown by default) -->
        <div id="welcome-screen">
          <div class="welcome-content">
            <div class="welcome-logo">
              <h1 data-i18n="title">Briefly</h1>
            </div>

            <!-- Quick action buttons -->
            <div class="quick-actions">
              <h3 data-i18n="quickActions">Quick Actions</h3>
              <div class="action-buttons-container">
                <button class="action-button" data-action="summarize">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <line x1="21" y1="6" x2="3" y2="6"></line>
                    <line x1="17" y1="12" x2="3" y2="12"></line>
                    <line x1="13" y1="18" x2="3" y2="18"></line>
                  </svg>
                  <span data-i18n="summarize">Summarize</span>
                </button>
                <button class="action-button" data-action="keypoints">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path
                      d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"
                    ></path>
                    <line x1="4" y1="22" x2="4" y2="15"></line>
                  </svg>
                  <span data-i18n="keyPoints">Key Points</span>
                </button>
                <button class="action-button" data-action="explain">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                  </svg>
                  <span data-i18n="explain">Explain</span>
                </button>
              </div>
            </div>

            <!-- Ask me anything input box -->
            <div class="welcome-search">
              <form id="welcome-form">
                <input
                  type="text"
                  id="welcome-input"
                  data-i18n-placeholder="askMeAnything"
                  placeholder="ask me anything"
                />
                <button type="submit" class="welcome-button">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                  </svg>
                </button>
              </form>
            </div>

            <!-- Spacer to push content to bottom -->
            <div class="welcome-spacer"></div>

            <!-- Generated questions moved to bottom -->
            <div class="welcome-footer">
              <div class="generated-questions" style="display: none">
                <h3 data-i18n="questionsAboutPage">
                  Questions about this page
                </h3>
                <div class="question-buttons-container">
                  <div class="question-loading">
                    <div class="spinner-small"></div>
                    <span data-i18n="generatingQuestions"
                      >Generating questions...</span
                    >
                  </div>
                </div>
              </div>

              <!-- Page context indicator will be added here dynamically -->
            </div>
          </div>
        </div>

        <!-- Chat screen (hidden initially) -->
        <div id="chat-screen" style="display: none">
          <div class="sidebar-content" id="chat-container">
            <!-- Chat messages will appear here -->
          </div>

          <div class="sidebar-footer">
            <form id="chat-form">
              <div class="input-container">
                <textarea
                  id="user-input"
                  data-i18n-placeholder="askAnything"
                  placeholder="Ask me anything..."
                  rows="1"
                ></textarea>
                <button type="submit" id="send-button" class="icon-button">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                  </svg>
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Notes screen (hidden initially) -->
        <div id="notes-screen" style="display: none">
          <div class="notes-header">
            <h3 data-i18n="pageNotes">Page Notes</h3>
            <div class="notes-actions">
              <button id="add-note-button" class="icon-button" title="Add Note">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="14"
                  height="14"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
              </button>
              <button
                id="close-notes-button"
                class="icon-button"
                data-i18n-title="close"
                title="Close Notes"
              >
                ×
              </button>
            </div>
          </div>

          <div id="notes-container" class="notes-content">
            <!-- Notes list will appear here -->
            <div class="notes-empty" id="notes-empty-state">
              <p data-i18n="noNotes">No notes for this page yet.</p>
              <button
                id="create-first-note"
                class="button"
                data-i18n="createFirstNote"
              >
                Create your first note
              </button>
            </div>
            <div id="notes-list">
              <!-- Notes will be added here dynamically -->
            </div>
          </div>

          <!-- Note editor (hidden initially) -->
          <div id="note-editor" style="display: none">
            <div class="note-editor-header">
              <h4 data-i18n="editNote">Edit Note</h4>
              <button
                id="close-editor-button"
                class="icon-button"
                data-i18n-title="close"
                title="Close Editor"
              >
                ×
              </button>
            </div>
            <textarea
              id="note-content"
              data-i18n-placeholder="writeNote"
              placeholder="Write your note here..."
            ></textarea>
            <div class="note-editor-actions">
              <button id="save-note-button" class="button" data-i18n="save">
                Save
              </button>
              <button
                id="cancel-note-button"
                class="button button-secondary"
                data-i18n="cancel"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>

        <!-- Content viewer screen (hidden initially) -->
        <div id="content-viewer-screen" style="display: none">
          <div class="content-viewer-header">
            <h3 data-i18n="pageContentViewer">Page Content Viewer</h3>
            <div class="content-viewer-actions">
              <button
                id="refresh-content-button"
                class="icon-button"
                data-i18n-title="refreshContent"
                title="Refresh Content"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="14"
                  height="14"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path
                    d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"
                  />
                </svg>
              </button>
              <button
                id="close-content-button"
                class="icon-button"
                data-i18n-title="close"
                title="Close Content Viewer"
              >
                ×
              </button>
            </div>
          </div>
          <div id="content-display" class="content-viewer-content">
            <div class="content-viewer-loading">
              <div class="spinner"></div>
              <p data-i18n="processingContent">Processing page content...</p>
            </div>
          </div>
        </div>

        <!-- API key container (shown as needed) -->
        <div class="api-key-container" style="display: none">
          <div class="settings-panel">
            <div class="settings-header">
              <h3 data-i18n="apiKeySettings">API Key Settings</h3>
            </div>
            <div class="settings-content">
              <p data-i18n="enterApiKeyMessage">
                Enter your OpenAI API key to use the assistant:
              </p>
              <div class="api-key-input-container">
                <input
                  type="password"
                  id="api-key"
                  data-i18n-placeholder="enterApiKey"
                  placeholder="Enter OpenAI API Key"
                />
                <button id="save-api-key" class="button" data-i18n="save">
                  Save Key
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Configuration container (hidden initially) -->
      <div id="config-container" class="config-container" style="display: none">
        <div class="config-header">
          <h3 data-i18n="responseSettings">Response Settings</h3>
          <button
            id="config-close"
            class="config-close"
            data-i18n-title="close"
            title="Close"
          >
            ×
          </button>
        </div>
        <div id="config-content">
          <!-- Configuration UI will be rendered here -->
        </div>
      </div>
    </div>

    <div id="account-popup" class="popup" style="display: none">
      <div class="popup-content">
        <button id="sign-out-button" class="button button-secondary">
          Sign Out
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            fill="currentColor"
            viewBox="0 0 24 24"
            class="auth-icon"
          >
            <title>logout</title>
            <path
              d="M17 7L15.59 8.41L18.17 11H8V13H18.17L15.59 15.58L17 17L22 12M4 5H12V3H4C2.9 3 2 3.9 2 5V19C2 20.1 2.9 21 4 21H12V19H4V5Z"
            />
          </svg>
        </button>
        <button class="button auth-button google-login-button header-button">
          <svg
            viewBox="0 0 262 262"
            xmlns="http://www.w3.org/2000/svg"
            height="16"
            width="16"
            class="auth-icon"
          >
            <g id="SVGRepo_iconCarrier">
              <path
                d="M255.878 133.451c0-10.734-.871-18.567-2.756-26.69H130.55v48.448h71.947c-1.45 12.04-9.283 30.172-26.69 42.356l-.244 1.622 38.755 30.023 2.685.268c24.659-22.774 38.875-56.282 38.875-96.027"
                fill="#4285F4"
              ></path>
              <path
                d="M130.55 261.1c35.248 0 64.839-11.605 86.453-31.622l-41.196-31.913c-11.024 7.688-25.82 13.055-45.257 13.055-34.523 0-63.824-22.773-74.269-54.25l-1.531.13-40.298 31.187-.527 1.465C35.393 231.798 79.49 261.1 130.55 261.1"
                fill="#34A853"
              ></path>
              <path
                d="M56.281 156.37c-2.756-8.123-4.351-16.827-4.351-25.82 0-8.994 1.595-17.697 4.206-25.82l-.073-1.73L15.26 71.312l-1.335.635C5.077 89.644 0 109.517 0 130.55s5.077 40.905 13.925 58.602l42.356-32.782"
                fill="#FBBC05"
              ></path>
              <path
                d="M130.55 50.479c24.514 0 41.05 10.589 50.479 19.438l36.844-35.974C195.245 12.91 165.798 0 130.55 0 79.49 0 35.393 29.301 13.925 71.947l42.211 32.783c10.59-31.477 39.891-54.251 74.414-54.251"
                fill="#EB4335"
              ></path>
            </g>
          </svg>
          Sign in with Google
        </button>

        <button class="button auth-button facebook-login-button header-button">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="16"
            width="16"
            viewBox="0 0 512 512"
            class="auth-icon"
          >
            <path
              fill="#0866ff"
              d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256C0 376 82.7 476.8 194.2 504.5V334.2H141.4V256h52.8V222.3c0-87.1 39.4-127.5 125-127.5c16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1c-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287V510.1C413.8 494.8 512 386.9 512 256h0z"
            />
          </svg>
          Sign in with Facebook
        </button>
      </div>
    </div>

    <div id="sign-in-alert-overlay" class="overlay" style="display: none">
      <div id="sign-in-alert-popup" class="popup">
        <div class="popup-content">
          <h3 class="popup-title">Sign In Required</h3>
          <p class="popup-message">
            You need to sign in to continue using this feature. Please sign in
            to proceed.
          </p>
          <button class="button auth-button google-login-button alert-button">
            <svg
              viewBox="0 0 262 262"
              xmlns="http://www.w3.org/2000/svg"
              height="16"
              width="16"
              class="auth-icon"
            >
              <g id="SVGRepo_iconCarrier">
                <path
                  d="M255.878 133.451c0-10.734-.871-18.567-2.756-26.69H130.55v48.448h71.947c-1.45 12.04-9.283 30.172-26.69 42.356l-.244 1.622 38.755 30.023 2.685.268c24.659-22.774 38.875-56.282 38.875-96.027"
                  fill="#4285F4"
                ></path>
                <path
                  d="M130.55 261.1c35.248 0 64.839-11.605 86.453-31.622l-41.196-31.913c-11.024 7.688-25.82 13.055-45.257 13.055-34.523 0-63.824-22.773-74.269-54.25l-1.531.13-40.298 31.187-.527 1.465C35.393 231.798 79.49 261.1 130.55 261.1"
                  fill="#34A853"
                ></path>
                <path
                  d="M56.281 156.37c-2.756-8.123-4.351-16.827-4.351-25.82 0-8.994 1.595-17.697 4.206-25.82l-.073-1.73L15.26 71.312l-1.335.635C5.077 89.644 0 109.517 0 130.55s5.077 40.905 13.925 58.602l42.356-32.782"
                  fill="#FBBC05"
                ></path>
                <path
                  d="M130.55 50.479c24.514 0 41.05 10.589 50.479 19.438l36.844-35.974C195.245 12.91 165.798 0 130.55 0 79.49 0 35.393 29.301 13.925 71.947l42.211 32.783c10.59-31.477 39.891-54.251 74.414-54.251"
                  fill="#EB4335"
                ></path>
              </g>
            </svg>
            Sign in with Google
          </button>
          <button class="button auth-button facebook-login-button alert-button">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              height="16"
              width="16"
              viewBox="0 0 512 512"
              class="auth-icon"
            >
              <path
                fill="#0866ff"
                d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256C0 376 82.7 476.8 194.2 504.5V334.2H141.4V256h52.8V222.3c0-87.1 39.4-127.5 125-127.5c16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1c-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287V510.1C413.8 494.8 512 386.9 512 256h0z"
              />
            </svg>
            Sign in with Facebook
          </button>
          <button
            id="close-sign-in-alert-button"
            class="button button-secondary"
          >
            Close
          </button>
        </div>
      </div>
    </div>

    <!-- Load scripts in correct order -->
    <script src="components/utils/ContentViewer.js"></script>
    <script type="module" src="scripts/sidebar.js"></script>

    <style>
      .language-toggle-section {
        display: flex;
        justify-content: flex-end;
        padding: 8px 16px;
        border-bottom: 1px solid var(--border);
      }

      .language-toggle-container {
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .toggle-label {
        font-size: 0.75rem;
        color: var(--muted-foreground);
        font-weight: 500;
      }

      .switch {
        position: relative;
        display: inline-block;
        width: 36px;
        height: 20px;
      }

      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--border);
        transition: 0.4s;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 14px;
        width: 14px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: 0.4s;
      }

      input:checked + .slider {
        background-color: var(--primary);
      }

      input:focus + .slider {
        box-shadow: 0 0 1px var(--primary);
      }

      input:checked + .slider:before {
        transform: translateX(16px);
      }

      .slider.round {
        border-radius: 20px;
      }

      .slider.round:before {
        border-radius: 50%;
      }
    </style>
  </body>
</html>
